# TYPE-INFERENCE 型推論

## Introduction はじめに

このセクションでは、TypeScriptの型推論について説明します。
つまり、型の推論がどこでどのように行われるかについて説明します。


## Basics 基本的な話

TypeScriptには、明示的な型の注釈がないときに型情報を提供するために型推論が使われるいくつかの場所があります。
たとえば、このコードでは…

```typescript
let x = 3;
```

`x` 変数の型は `number` であると推定されます。
この種の推論は、変数とメンバの初期化、パラメータのデフォルト値の設定、関数の戻り値の型の決定時に行われます。

ほとんどの場合、型推論は簡単です。 次のセクションでは、型の推定方法のニュアンスをいくつか調べます。


## Best common type 最良の共通型

いくつかの式から型推論が行われるとき、それらの式の型は 「最良の共通型」を計算するために使われます。
例えば…

```typescript
let x = [0, 1, null];
```

上の例で `x` の型を推測するには、各配列要素の型を考慮する必要があります。
ここでは、配列の型として `number` と `null` の2つの選択肢が与えられています。
最良の共通型アルゴリズムは、各候補型を考慮し、他のすべての候補と互換性のある型を選択します。

提供された候補型から最良の共通型を選択する必要があるため、型が共通の構造を共有する場合もありますが、すべての候補型のスーパータイプはありません。
例えば…

```typescript
let zoo = [new Rhino(), new Elephant(), new Snake()];
```

動物園は `Animal[]` として推論されることが望ましいかもしれませんが、厳密に `Animal` 型であるオブジェクトは配列内に存在しないので、配列要素の型についての推論は行いません。
この問題を解決するには、いずれの型も他のすべての候補のスーパータイプでない場合は、明示的に型を指定します。

```typescript
let zoo: Animal[] = [new Rhino(), new Elephant(), new Snake()];
```

最も一般的な型が見つからない場合、結果として得られる推論は連合配列型 `(Rhino | Elephant | Snake)[]`です。


## Contextual Type 文脈上の型

型推論は、TypeScriptの「ある方向」でも機能します。
これは「文脈型」と呼ばれます。
文脈型は、式の型がその場所によって暗示されている場合に発生します。
例えば…


```typescript
window.onmousedown = function(mouseEvent) {
    console.log(mouseEvent.button);  //<- Error
};
```

上記のコードで型エラーが発生すると、TypeScript型のチェッカーは `window.onmousedown` 関数の型を使用して、代入の右辺にある関数式の型を推測しました。
そうすると、 `mouseEvent` パラメータのタイプを推論することができました。
この関数式が文脈上の型付けされた位置にない場合、 `mouseEvent` パラメータは `any` 型を持ち、エラーは発行されません。

文脈的に型付けされた式に明示的な型情報が含まれる場合、文脈型は無視されます。
上記の例を書いたとします。

```typescript
window.onmousedown = function(mouseEvent: any) {
    console.log(mouseEvent.button);  //<- Now, no error is given
};
```

パラメータに明示的な型の注釈を持つ関数式は、コンテキスト型をオーバーライドします。
一旦それが行われると、コンテキストタイプが適用されないのでエラーは出されません。

文脈型は、多くの場合に適用されます。
一般的なケースには、関数呼び出しの引数、代入の右辺、型アサーション、オブジェクトと配列リテラルのメンバ、および `return` 文が含まれます。
文脈型は、最も一般的な型の候補タイプとしても機能します。
例えば…

```typescript
function createZoo(): Animal[] {
    return [new Rhino(), new Elephant(), new Snake()];
}
```

この例では、最も一般的な型は、 `Animal` 、 `Rhino`、 `Elephant` 、`Snake` の4つの候補のセットを持っています。
これらのうち、`Animal` は、最良の共通型のアルゴリズムによって選択することができます。

